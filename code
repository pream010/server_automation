<form>
  <label>Linux Automation</label>
  <fieldset submitButton="false">
    <input type="time" token="field1">
      <label>Time Range</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
      <center>
          <p>
            <b>
            <font color="blue">Dashboard Developed for Patching Automation</font>
          </b> : <b>For feedback reach out to</b>: <b>
            <font color="red">DL-GBL-PatchMgtReport@firstdata.com</font>
          </b>
        </p>
        </center>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Servers Attempt Patching</title>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" platform=linux |dedup hostname | replace "/var/log/patching_log/patching_success.log" with "Success", "/var/log/patching_log/patching_error.log" with "Failed" in source |dedup hostname | table hostname | search source!="/var/log/patching_log/patched_status.log" | chart count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">Total no. of Server Attempt Patching</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Script Success vs Failed</title>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" platform=linux | replace "/var/log/patching_log/patching_success.log" with "Success", "/var/log/patching_log/patching_error.log" with "Failed", "/var/log/patching_log/scheduling_patching_error.log" with "Failed", "/var/log/patching_log/scheduling_patching_success.log" with "Success" in source | table _time hostname platform script_name source Output | search source!="/var/log/patching_log/patched_status.log" | chart count by source</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Total Patched vs Not-Patched</title>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" source=/var/log/patching_log/patched_status.log |dedup host |stats latest(os) as os latest(os_version) as os_version latest(os_level) as os_level latest(oel_kernel_version) as oel_kernel_version latest(Status) as Status latest(pending_pkg) as pending_pkg latest(pending_reboot) as pending_reboot latest(last_kernel_updated_date) as last_kernel_updated_date latest(last_pkg_installed_date) as last_pkg_installed_date latest(frequency) as frequency latest(uptime) as uptime by hostname | chart count by Status</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <input type="dropdown" token="platform">
        <label>Platform</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>platform</fieldForLabel>
        <fieldForValue>platform</fieldForValue>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" |dedup platform | table platform</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
      </input>
      <input type="dropdown" token="script_name">
        <label>Script_Name</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>script_name</fieldForLabel>
        <fieldForValue>script_name</fieldForValue>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" source="/var/log/patching_log/patching_success.log" | dedup script_name | table script_name</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
      </input>
      <input type="dropdown" token="source">
        <label>Status</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>source</fieldForLabel>
        <fieldForValue>source</fieldForValue>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" Linux source="/var/log/patching_log/patching_success.log" OR source="/var/log/patching_log/patching_error.log"|dedup source | replace "/var/log/patching_log/patching_success.log" with "Success", "/var/log/patching_log/patching_error.log" with "Failed" in source | table source</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
      </input>
      <input type="text" token="hostname">
        <label>Hostname</label>
        <default>*</default>
        <prefix>"</prefix>
        <suffix>*"</suffix>
      </input>
      <table>
        <title>Linux Patching Log</title>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" platform=linux | replace "/var/log/patching_log/patching_success.log" with "Success", "/var/log/patching_log/patching_error.log" with "Failed" in source | table _time hostname platform script_name source Output |sort by _time desc | search source!="/var/log/patching_log/patched_status.log" AND hostname=$hostname$ AND script_name=$script_name$ AND source=$source$ AND platform=$platform$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">15</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="source">
          <colorPalette type="map">{"Failed":#DC4E41,"Success":#B6C75A}</colorPalette>
        </format>
        <format type="color" field="hostname">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="script_name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <input type="dropdown" token="log_available">
        <label>log_available</label>
        <choice value="*">All</choice>
        <choice value="&quot;Yes&quot;">Yes</choice>
        <choice value="&quot;No&quot;">No</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>log_available</fieldForLabel>
        <fieldForValue>log_available</fieldForValue>
        <search>
          <query/>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
      </input>
      <input type="dropdown" token="date">
        <label>date</label>
        <choice value="*">All</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>date</fieldForLabel>
        <fieldForValue>date</fieldForValue>
        <search>
          <query>| inputlookup linux_automation_patch.csv | eval date=substr(date_time, 0, len(date_time)-5) | eval time_utc=substr(date_time, 11, len(date_time)-13) |dedup date |table date</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
      </input>
      <input type="text" token="hostname">
        <label>hostname</label>
        <default>*</default>
        <prefix>"</prefix>
        <suffix>*"</suffix>
        <initialValue>*</initialValue>
      </input>
      <table>
        <title>Schedule vs Job Trigger</title>
        <search>
          <query>| inputlookup linux_automation_patch.csv |eval hostname=lower(hostname) | eval date=substr(date_time, 0, len(date_time)-5) | eval time_utc=substr(date_time, 11, len(date_time)-13) |sort date,time_utc |table hostname date time_utc date_time
|join type=outer [search index=salt_na sourcetype="patching:automation" source!="/var/log/patching_log/patched_status.log" AND source!="/var/log/patching_log/patchingsplunk.log" platform="Linux" |dedup hostname |table hostname platform] |eval log_available=if(platform="Linux","Yes","No") |table hostname log_available date date_time |search hostname=$hostname$ AND date=$date$ AND log_available=$log_available$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="log_available">
          <colorPalette type="map">{"Yes":#B6C75A,"No":#DC4E41}</colorPalette>
        </format>
        <format type="color" field="date">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="time_utc">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
        <format type="color" field="date_time">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <input type="text" token="hostname">
        <label>Enter the server name</label>
        <default>*</default>
        <prefix>"</prefix>
        <suffix>*"</suffix>
      </input>
      <table>
        <title>Linux Post Patch Status</title>
        <search>
          <query>index="salt_na" sourcetype="patching:automation" source="/var/log/patching_log/patched_status.log" os=linux |stats latest(os) as os latest(os_version) as os_version latest(os_level) as os_level latest(oel_kernel_version) as oel_kernel_version latest(Status) as Status latest(pending_pkg) as pending_pkg latest(pending_reboot) as pending_reboot latest(last_kernel_updated_date) as last_kernel_updated_date latest(last_pkg_installed_date) as last_pkg_installed_date latest(frequency) as frequency latest(uptime) as uptime by hostname |search hostname=$hostname$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>2m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="color" field="status">
          <colorPalette type="map">{"Patched":#53A051,"Not-Patched":#006D9C}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
</form>
